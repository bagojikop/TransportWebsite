<div class="module-access-wrapper">
  <!-- Sidebar Component -->
  <app-sidebar></app-sidebar>

  <!-- Main Content -->
  <div class="main-content">
    <div class="module-access-container">
      <!-- Header -->
      <div class="header">
        <div class="header-left">
          <h1>Module Access Control</h1>
          <p class="sub-header">Configure role-based permissions for system users</p>
        </div>
      </div>

      <!-- User Selection Card -->
      <div class="selection-card">
        <div class="selection-header">
          <div class="header-icon">
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="#0a2a44"
                d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
            </svg>
          </div>
          <h3>Select User</h3>
        </div>

        <div class="selection-content">
          <div class="select-wrapper">
            <select id="userSelect" class="custom-select" [(ngModel)]="userId" (change)="onUserChange()">
              <option value="" disabled selected>Choose a user to configure</option>
              <option *ngFor="let user of users" [value]="user.userId">
                {{ user.userLongname }} · {{ user.isAdmin ?'System User' :'User' }}
              </option>
            </select>
            <span class="select-arrow">▼</span>
          </div>
        </div>
      </div>

      <!-- Access Control Card -->
      <div class="access-card" *ngIf="userId">
        <div class="card-header">
          <div class="user-badge">
            <span class="user-avatar">{{ getSelectedUserInitials() }}</span>
            <div class="user-details">
              <span class="user-name">{{ getSelectedUserName() }}</span>
              <span class="user-role">{{ getSelectedUserRole() }}</span>
            </div>
          </div>
          <div class="access-summary">
            <span class="summary-item">
              <strong>{{ getGrantedCount() }}</strong> Granted
            </span>
            <span class="summary-item">
              <strong>{{modules.length - getGrantedCount() }}</strong> Restricted
            </span>
          </div>
        </div>

        <div class="modules-container">
          <div class="modules-grid">

            <div class="module-item" *ngFor="let module of modules" [class.access-granted]="module.status">

              <div class="module-details">
                <span class="module-name">{{ module.moduleName }}</span>
              </div>

              <div class="module-access">
                <label class="toggle-switch">
                  <input type="checkbox" [(ngModel)]="module.status" />
                  <span class="toggle-slider"></span>
                </label>
              </div>

            </div>

          </div>
        </div>


        <div class="card-footer">
          <div class="action-buttons">
            <button class="btn btn-secondary" (click)="cancelChanges()">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <path fill="currentColor"
                  d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
              </svg>
              Cancel
            </button>
            <button class="btn btn-primary" (click)="saveModuleAccess()">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
              </svg>
              Save Changes
            </button>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="!userId">
        <div class="empty-icon">
          <svg viewBox="0 0 24 24" width="64" height="64">
            <path fill="#cbd5e0"
              d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67V7z" />
          </svg>
        </div>
        <h3>No User Selected</h3>
        <p>Please select a user from the dropdown above to configure module access permissions.</p>
      </div>
    </div>
  </div>
</div>
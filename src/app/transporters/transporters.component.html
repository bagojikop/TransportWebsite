<div class="transporters-wrapper">
  <!-- Sidebar Component -->
  <app-sidebar></app-sidebar>

  <!-- Main Content -->
  <div class="main-content">
    <div class="transporters-container">
      <!-- Header -->
      <div class="header d-flex justify-content-between align-items-center">
        <div>
          <h1>Transporters</h1>
          <p class="sub-header">Add new transporter firm details</p>
        </div>
        <div class="form-actions me-3">
          <button type="button" class="btn btn-cancel" (click)="cancel()">Cancel</button>
          <button type="submit" class="btn btn-submit" [disabled]="transporterForm.invalid" (click)="saveTransporter()">
            Save Transporter
          </button>
        </div>
      </div>

      <!-- Form Card - Yeh container FIXED rahega, andar scroll hoga -->
      <div class="form-card">
        <form #transporterForm="ngForm">

          <!-- ðŸŸ¢ STICKY SECTION - Yeh top par chipka rahega -->
          <div class="sticky-section">
            <h2>Firm Details</h2>

            <div class="form-row">
              <!-- Column 1: Firm Name and Short Name -->
              <div class="form-group-column">
                <div class="form-group">
                  <label for="firmName">Firm Name <span class="required">*</span></label>
                  <input type="text" id="firmName" name="firmName" class="form-control" placeholder="Enter firm name"
                    [(ngModel)]="transporterData.firmName" #firmName="ngModel" required />
                  <div *ngIf="firmName.invalid && firmName.touched" class="error-message">
                    Firm name is required
                  </div>
                </div>

                <div class="form-group">
                  <label for="shortName">Short Name</label>
                  <div class="input-with-counter">
                    <input type="text" id="shortName" name="shortName" class="form-control" placeholder="Max 4 chars"
                      [(ngModel)]="transporterData.firmAlias" #shortName="ngModel" maxlength="4" />
                    <span class="char-counter">{{ transporterData.firmAlias?.length || 0 }}/4</span>
                  </div>
                </div>
              </div>

              <!-- Column 2: Address -->
              <div class="form-group-column">
                <div class="form-group">
                  <label for="address">Address <span class="required">*</span></label>
                  <textarea id="address" name="address" class="form-control address-textarea" rows="3"
                    placeholder="Enter complete address" [(ngModel)]="transporterData.firmAddress" #address="ngModel"
                    required></textarea>
                  <div *ngIf="address.invalid && address.touched" class="error-message">
                    Address is required
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ðŸ”µ SCROLLABLE SECTION - Sirf yeh scroll hoga -->
          <div class="scrollable-section">
            <!-- Row 2: Jurisdiction, Transporter ID & PAN Number -->
            <div class="form-row three-columns">
              <div class="form-group">
                <label for="jurisdiction">Jurisdiction <span class="required">*</span></label>
                <input type="text" id="jurisdiction" name="jurisdiction" class="form-control"
                  placeholder="Enter jurisdiction" [(ngModel)]="transporterData.jurisdiction" #jurisdiction="ngModel"
                  required />
                <div *ngIf="jurisdiction.invalid && jurisdiction.touched" class="error-message">
                  Jurisdiction is required
                </div>
              </div>

              <div class="form-group">
                <label for="transporterId">Transporter ID <span class="required">*</span></label>
                <input type="text" id="transporterId" name="transporterId" class="form-control"
                  placeholder="Enter transporter ID" [(ngModel)]="transporterData.firm_transId"
                  #transporterId="ngModel" required />
                <div *ngIf="transporterId.invalid && transporterId.touched" class="error-message">
                  Transporter ID is required
                </div>
              </div>

              <div class="form-group">
                <label for="panNumber">PAN Number</label>
                <input type="text" id="panNumber" name="panNumber" class="form-control"
                  placeholder="Enter PAN number (optional)" [(ngModel)]="transporterData.firmPan" #panNumber="ngModel"
                  pattern="^[A-Z]{5}[0-9]{4}[A-Z]{1}$"
                  (input)="transporterData.firmPan = (transporterData.firmPan || '').toUpperCase()" />
                <div *ngIf="panNumber?.invalid && panNumber?.touched" class="error-message">
                  Enter a valid PAN number (e.g., ABCDE1234F)
                </div>
              </div>
            </div>

            <!-- Row 3: State, Place & Pincode -->
            <div class="form-row three-columns">
              <div class="form-group">
                <label for="state">State <span class="required">*</span></label>
                <select id="state" name="state" class="form-control" [(ngModel)]="transporterData.firmStateCode"
                  #state="ngModel" required (change)="onStateChange($event)">
                  <option value="" disabled selected>Select State</option>
                  <option *ngFor="let state of states" [value]="state.stateCode">
                    {{ state.stateName }}
                  </option>
                </select>
                <div *ngIf="state.invalid && state.touched" class="error-message">
                  State is required
                </div>
              </div>

              <div class="form-group">
                <label for="place">Place <span class="required">*</span></label>
                <input type="text" id="place" name="place" class="form-control" placeholder="Enter place"
                  [(ngModel)]="transporterData.firmPlace" #place="ngModel" required />
                <div *ngIf="place.invalid && place.touched" class="error-message">
                  Place is required
                </div>
              </div>

              <div class="form-group">
                <label for="pincode">Pincode <span class="required">*</span></label>
                <input type="text" id="pincode" name="pincode" class="form-control" placeholder="Enter pincode"
                  [(ngModel)]="transporterData.firmPinCode" #pincode="ngModel" required pattern="^[1-9][0-9]{5}$"
                  maxlength="6" />
                <div *ngIf="pincode.invalid && pincode.touched" class="error-message">
                  Enter a valid 6-digit pincode
                </div>
              </div>
            </div>

            <!-- Row 4: Office Phone, Contact No & Email -->
            <div class="form-row three-columns">
              <div class="form-group">
                <label for="officePhone">Office Phone No</label>
                <input type="tel" id="officePhone" name="officePhone" class="form-control"
                  placeholder="Enter office phone" [(ngModel)]="transporterData.firmFno" #officePhone="ngModel"
                  pattern="^[0-9]{10,12}$" />
                <div *ngIf="officePhone?.invalid && officePhone?.touched" class="error-message">
                  Enter a valid phone number
                </div>
              </div>

              <div class="form-group">
                <label for="mobile">Contact No</label>
                <input type="tel" id="mobile" name="mobile" class="form-control" placeholder="Enter contact number"
                  [(ngModel)]="transporterData.firmMobNo" #mobile="ngModel" pattern="^[0-9]{10}$" maxlength="10" />
                <div *ngIf="mobile?.invalid && mobile?.touched" class="error-message">
                  Enter a valid 10-digit mobile number
                </div>
              </div>

              <div class="form-group">
                <label for="email">Email ID</label>
                <input type="email" id="email" name="email" class="form-control" placeholder="Enter email address"
                  [(ngModel)]="transporterData.emailId" #email="ngModel" email />
                <div *ngIf="email?.invalid && email?.touched" class="error-message">
                  Enter a valid email address
                </div>
              </div>
            </div>

            <!-- Row 5: Logo Upload -->
            <div class="form-row">
              <div class="form-group full-width">
                <label for="logo">Company Logo (Optional)</label>
                <div class="logo-upload-container">
                  <div class="logo-upload-wrapper">
                    <input type="file" id="logo" name="logo" class="file-input" (change)="onLogoSelected($event)"
                      accept="image/*" #logoInput />
                    <button type="button" class="file-input-label" (click)="logoInput.click()">
                      <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                      </svg>
                      <span>{{ transporterData.mst00401?.logo ? 'Change Logo' : 'Choose Logo' }}</span>
                    </button>
                    <div class="hint">Supported: JPG, PNG, GIF (Max 2MB)</div>
                  </div>

                  <div *ngIf="transporterData.mst00401?.logo" class="logo-preview-wrapper">
                    <div class="logo-preview">
                      <img [src]="transporterData.mst00401?.logo" alt="Logo preview" />
                      <button type="button" class="remove-logo" (click)="removeLogo()" title="Remove logo">Ã—</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- GST Details Section -->
            <div class="gst-section">
              <h3>GST Details <span class="optional-badge">Optional</span></h3>

              <div class="form-row three-columns">
                <div class="form-group">
                  <label for="gstStartDate">GST Start Date</label>
                  <input type="date" id="gstStartDate" name="gstStartDate" class="form-control"
                    [(ngModel)]="transporterData.mst00409!.gstFrom" />
                </div>

                <div class="form-group">
                  <label for="gstType">GST Type</label>
                  <select id="gstType" name="gstType" class="form-control" [(ngModel)]="transporterData.mst00409!.gstTyp">
                    <option value="" disabled selected>Select GST Type</option>
                    <option value="Regular">Regular</option>
                    <option value="Composition">Composition</option>
                    <option value="Casual">Casual Taxable Person</option>
                    <option value="Non-Resident">Non-Resident</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="gstNumber">GST Number</label>
                  <div class="input-with-counter">
                    <input type="text" id="gstNumber" name="gstNumber" class="form-control"
                      placeholder="Enter 15-digit GST number" [(ngModel)]="transporterData.mst00409!.gstNo"
                      #gstNumber="ngModel" maxlength="15"
                      pattern="^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}[Z]{1}[0-9A-Z]{1}$"
                      (input)="transporterData.mst00409!.gstNo = (transporterData.mst00409!.gstNo || '').toUpperCase()" />
                    <span class="char-counter">{{ transporterData.mst00409?.gstNo?.length || 0 }}/15</span>
                  </div>
                  <div *ngIf="gstNumber?.invalid && gstNumber?.touched" class="error-message">
                    Enter a valid GST number
                  </div>
                </div>
              </div>
            </div>

            <!-- Bank Information Section -->
            <div class="bank-section">
              <h3>Bank Information <span class="optional-badge">Optional</span></h3>

              <div class="form-row three-columns">
                <div class="form-group">
                  <label for="bankName">Bank Name</label>
                  <input type="text" id="bankName" name="bankName" class="form-control" placeholder="Enter bank name"
                    [(ngModel)]="transporterData.firmBankName" />
                </div>

                <div class="form-group">
                  <label for="bankAccountNo">Bank Account No</label>
                  <input type="text" id="bankAccountNo" name="bankAccountNo" class="form-control"
                    placeholder="Enter account number" [(ngModel)]="transporterData.firmBankAccno"
                    #bankAccountNo="ngModel" pattern="^[0-9]{9,18}$" />
                  <div *ngIf="bankAccountNo?.invalid && bankAccountNo?.touched" class="error-message">
                    Enter valid account number (9-18 digits)
                  </div>
                </div>

                <div class="form-group">
                  <label for="ifscCode">IFSC Code</label>
                  <input type="text" id="ifscCode" name="ifscCode" class="form-control" placeholder="Enter IFSC code"
                    [(ngModel)]="transporterData.firmBankIfsc" #ifscCode="ngModel" pattern="^[A-Z]{4}0[A-Z0-9]{6}$"
                    (input)="transporterData.firmBankIfsc = (transporterData.firmBankIfsc || '').toUpperCase()" />
                  <div *ngIf="ifscCode?.invalid && ifscCode?.touched" class="error-message">
                    Enter valid IFSC code (e.g., SBIN0123456)
                  </div>
                </div>
              </div>
            </div>

            <!-- Form Actions -->

          </div>
        </form>
      </div>
    </div>
  </div>
</div>